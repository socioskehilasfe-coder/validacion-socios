<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Validación de Socio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Arial, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #0b3c6f, #092a4a);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card {
      background: #fff;
      width: 100%;
      max-width: 380px;
      padding: 26px 22px;
      border-radius: 24px;
      box-shadow: 0 18px 36px rgba(0,0,0,.3);
      text-align: center;
    }

    h1 {
      font-size: 20px;
      color: #0b3c6f;
      margin-bottom: 14px;
    }

    .dato {
      font-size: 15px;
      margin: 6px 0;
      color: #374151;
    }

    .estado {
      margin-top: 14px;
      padding: 10px;
      border-radius: 14px;
      font-weight: 600;
      font-size: 14px;
    }

    .activo { background: #dcfce7; color: #166534; }
    .inactivo { background: #fee2e2; color: #991b1b; }

    .fecha {
      margin-top: 8px;
      font-size: 13px;
      color: #6b7280;
    }

    select {
      width: 100%;
      margin-top: 16px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #cbd5e1;
      font-size: 14px;
    }

    .beneficio {
      margin-top: 12px;
      font-size: 14px;
      padding: 10px;
      border-radius: 12px;
      display: none;
    }

    .beneficio.ok {
      background: #e0f2fe;
      color: #075985;
      display: block;
    }

    .beneficio.error {
      background: #fee2e2;
      color: #991b1b;
      display: block;
    }

    .btn {
      margin-top: 16px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid #0b3c6f;
      background: transparent;
      color: #0b3c6f;
      font-size: 15px;
    }

    .btn.disabled {
      opacity: .4;
      pointer-events: none;
    }
  </style>
</head>

<body>

<div class="card">
  <h1>Credencial de Socio</h1>

  <div class="dato"><strong>Nombre:</strong> <span id="nombre"></span></div>
  <div class="dato"><strong>Apellido:</strong> <span id="apellido"></span></div>
  <div class="dato"><strong>DNI:</strong> <span id="dni"></span></div>

  <div id="estado" class="estado"></div>
  <div id="fechaHora" class="fecha"></div>

  <select id="comercioSelect">
    <option value="">Seleccionar comercio</option>
  </select>

  <div id="beneficioBox" class="beneficio"></div>

  <button id="btnValidar" class="btn" onclick="registrar()">Validar beneficio</button>
</div>

<script>
  const SOCIOS_URL = "https://opensheet.elk.sh/TU_SHEET_ID/SOCIOS";
  const BENEFICIOS_URL = "https://opensheet.elk.sh/TU_SHEET_ID/BENEFICIOS";
  const SCRIPT_URL = "PEGÁ_ACÁ_TU_APPS_SCRIPT";

  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const ahora = new Date();
  fechaHora.textContent =
    `Validado el ${ahora.toLocaleDateString("es-AR")} – ${ahora.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"})} hs`;

  let socio;
  let beneficios = [];

  fetch(SOCIOS_URL)
    .then(r => r.json())
    .then(data => {
      socio = data.find(s => s.ID === id);
      if (!socio) return alert("Socio no encontrado");

      nombre.textContent = socio.Nombre;
      apellido.textContent = socio.Apellido;
      dni.textContent = socio.DNI;

      if (socio.Estado === "ACTIVO") {
        estado.textContent = "SOCIO ACTIVO";
        estado.classList.add("activo");
      } else {
        estado.textContent = "SOCIO INACTIVO";
        estado.classList.add("inactivo");
        btnValidar.classList.add("disabled");
      }
    });

  fetch(BENEFICIOS_URL)
    .then(r => r.json())
    .then(data => {
      beneficios = data;
      data.forEach(b => {
        const opt = document.createElement("option");
        opt.value = b.Comercio;
        opt.textContent = b.Comercio;
        comercioSelect.appendChild(opt);
      });
    });

  comercioSelect.addEventListener("change", () => {
    const seleccionado = beneficios.find(
      b => b.Comercio === comercioSelect.value
    );

    if (seleccionado) {
      beneficioBox.textContent = "Beneficio: " + seleccionado.Beneficio;
      beneficioBox.className = "beneficio ok";
    } else {
      beneficioBox.textContent = "Este comercio no tiene convenio";
      beneficioBox.className = "beneficio error";
    }
  });

  function registrar() {
    const seleccionado = beneficios.find(
      b => b.Comercio === comercioSelect.value
    );

    if (!seleccionado) {
      alert("Este comercio no tiene beneficio");
      return;
    }

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({
        socio: socio.ID,
        comercio: seleccionado.Comercio,
        beneficio: seleccionado.Beneficio,
        fecha: ahora.toISOString()
      })
    });

    alert("Beneficio validado correctamente");
  }
</script>

</body>
</html>
