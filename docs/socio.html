<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Credencial de Socio</title>

<style>
*{
  box-sizing:border-box;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(180deg,#0b3c6d,#062645);
  display:flex;
  align-items:center;
  justify-content:center;
}

.card{
  background:white;
  width:92%;
  max-width:420px;
  border-radius:24px;
  padding:24px;
  text-align:center;
  box-shadow:0 20px 50px rgba(0,0,0,.25);
}

.logo{
  width:120px;
  margin:0 auto 10px;
}

h2{
  margin:10px 0 20px;
  color:#0b3c6d;
}

.info{
  text-align:left;
  margin-bottom:14px;
}

.info b{
  color:#0b3c6d;
}

.estado{
  padding:14px;
  border-radius:14px;
  font-weight:600;
  margin:12px 0;
}

.activo{
  background:#dcfce7;
  color:#166534;
}

.inactivo{
  background:#fee2e2;
  color:#991b1b;
}

.ingreso{
  font-size:13px;
  color:#555;
  margin-bottom:14px;
}

.lista-comercios{
  max-height:260px;
  overflow-y:auto;
  margin-top:10px;
}

.comercio{
  display:flex;
  gap:12px;
  align-items:center;
  padding:12px;
  background:#f7f9fc;
  border-radius:14px;
  margin-bottom:10px;
  cursor:pointer;
  transition:.2s;
}

.comercio:hover{
  background:#e9f0ff;
}

.comercio.activo{
  outline:2px solid #0b3c6d;
  background:#e6f0ff;
}

.comercio img{
  width:42px;
  height:42px;
  object-fit:contain;
  background:white;
  border-radius:8px;
}

.comercio strong{
  font-size:14px;
}

.comercio small{
  font-size:12px;
  color:#555;
}

button{
  width:100%;
  margin-top:14px;
  padding:15px;
  font-size:16px;
  border:none;
  border-radius:16px;
  background:#0b3c6d;
  color:white;
  cursor:pointer;
  transition:.2s;
}

button:disabled{
  opacity:.5;
  cursor:default;
}
</style>
</head>

<body>

<div class="card">
  <img src="logo.png" class="logo">

  <h2>Credencial de Socio</h2>

  <div class="info"><b>Nombre:</b> <span id="nombre"></span></div>
  <div class="info"><b>Apellido:</b> <span id="apellido"></span></div>
  <div class="info"><b>DNI:</b> <span id="dni"></span></div>

  <div id="estado" class="estado"></div>

  <div class="ingreso" id="ingreso"></div>

  <h3>Seleccionar comercio</h3>
  <div id="listaComercios" class="lista-comercios"></div>

  <button id="btnValidar" disabled onclick="validar()">Validar beneficio</button>
</div>

<script>
/* ========= CONFIGURACIÓN ========= */
const SOCIOS_URL   = "https://opensheet.elk.sh/132gab3uRyy7_DnkFoyCNbBnoxXDu6gbXiIDr5LTe4nA/SOCIOS";
const COMERCIOS_URL= "https://opensheet.elk.sh/132gab3uRyy7_DnkFoyCNbBnoxXDu6gbXiIDr5LTe4nA/COMERCIOS";
const REGISTRO_URL = "https://script.google.com/macros/s/TU_SCRIPT/exec";

/* ========= VARIABLES ========= */
const params = new URLSearchParams(location.search);
const id = params.get("id");

let socio = null;
let comercioSeleccionado = null;

/* ========= FECHA / HORA ========= */
const ahora = new Date();
const fecha = ahora.toLocaleDateString("es-AR");
const hora  = ahora.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"});

/* ========= CARGAR SOCIO ========= */
fetch(SOCIOS_URL)
  .then(r=>r.json())
  .then(data=>{
    socio = data.find(s=>s.ID===id);
    if(!socio){
      document.body.innerHTML="Socio no encontrado";
      return;
    }

    nombre.textContent = socio.Nombre;
    apellido.textContent = socio.Apellido;
    dni.textContent = socio.DNI;

    estado.textContent = socio.Estado==="ACTIVO" ? "SOCIO ACTIVO" : "SOCIO INACTIVO";
    estado.classList.add(socio.Estado==="ACTIVO"?"activo":"inactivo");

    ingreso.textContent = `Ingresó el ${fecha} – ${hora}`;
  });

/* ========= CARGAR COMERCIOS ========= */
fetch(COMERCIOS_URL)
  .then(r=>r.json())
  .then(data=>{
    listaComercios.innerHTML="";
    data.forEach(c=>{
      const div=document.createElement("div");
      div.className="comercio";
      div.innerHTML=`
        <img src="${c.Logo}">
        <div>
          <strong>${c.Comercio}</strong><br>
          <small>${c.Beneficio}</small>
        </div>
      `;
      div.onclick=()=>{
        document.querySelectorAll(".comercio").forEach(x=>x.classList.remove("activo"));
        div.classList.add("activo");
        comercioSeleccionado=c;
        btnValidar.disabled=false;
      };
      listaComercios.appendChild(div);
    });
  });

/* ========= VALIDAR ========= */
function validar(){
  if(!comercioSeleccionado) return;

  fetch(REGISTRO_URL,{
    method:"POST",
    body:JSON.stringify({
      Fecha:fecha,
      Hora:hora,
      Comercio:comercioSeleccionado.Comercio,
      Beneficio:comercioSeleccionado.Beneficio,
      ID:socio.ID,
      Nombre:socio.Nombre,
      Apellido:socio.Apellido,
      DNI:socio.DNI
    })
  }).then(()=>{
    alert("Beneficio registrado correctamente");
    btnValidar.disabled=true;
  });
}
</script>

</body>
</html>
