<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Admin</title>

<style>
:root{
  --azul:#0b3c6d;
  --azul2:#0e4f8f;
  --blanco:#ffffff;
  --gris:#f2f4f7;
  --verde:#1fa36b;
  --rojo:#c0392b;
}

*{box-sizing:border-box;font-family:system-ui}

body{
  margin:0;
  background:var(--gris);
  display:flex;
}

/* ===== MENU ===== */
aside{
  width:240px;
  background:linear-gradient(180deg,var(--azul),var(--azul2));
  color:#fff;
  padding:20px;
  transition:.3s;
}

aside img{
  width:120px;
  display:block;
  margin:0 auto 20px;
}

aside h2{
  text-align:center;
  margin-bottom:30px;
}

aside button{
  width:100%;
  background:none;
  border:none;
  color:#fff;
  text-align:left;
  padding:14px;
  font-size:16px;
  border-radius:10px;
  cursor:pointer;
  transition:.3s;
}

aside button:hover,
aside button.active{
  background:rgba(255,255,255,.15);
}

/* ===== CONTENIDO ===== */
main{
  flex:1;
  padding:30px;
  overflow:auto;
}

section{display:none}
section.active{display:block}

/* ===== SOCIOS ===== */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:20px;
}

.card{
  background:#fff;
  padding:20px;
  border-radius:20px;
  text-align:center;
  cursor:pointer;
  transition:.3s;
}

.card:hover{
  transform:translateY(-5px);
}

.card img{
  width:160px;
  margin:10px auto;
}

.estado{
  font-weight:bold;
  margin-top:10px;
}

.activo{color:var(--verde)}
.inactivo{color:var(--rojo)}

.vence{
  color:#666;
  font-size:14px;
}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal .box{
  background:#fff;
  padding:30px;
  border-radius:20px;
  max-width:400px;
  width:90%;
  text-align:center;
  position:relative;
}

.modal .close{
  position:absolute;
  top:15px;
  right:20px;
  font-size:22px;
  cursor:pointer;
}

/* ===== FORM ===== */
form{
  max-width:500px;
  background:#fff;
  padding:30px;
  border-radius:20px;
}

form input{
  width:100%;
  padding:14px;
  font-size:16px;
  margin-bottom:15px;
  border-radius:10px;
  border:1px solid #ccc;
}

form button{
  width:100%;
  padding:14px;
  font-size:18px;
  border:none;
  border-radius:12px;
  background:var(--azul);
  color:#fff;
  cursor:pointer;
}

/* ===== STATS ===== */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
}

.stat{
  background:#fff;
  padding:20px;
  border-radius:20px;
  text-align:center;
}
.stat strong{font-size:28px}
.stat span{color:#666}
</style>
</head>

<body>

<aside>
  <img src="logo.png">
  <h2>Panel Admin</h2>

  <button class="active" onclick="show('socios')">Socios</button>
  <button onclick="show('alta')">Alta socio</button>
  <button onclick="show('stats')">Estadísticas</button>
</aside>

<main>

<!-- ===== SOCIOS ===== -->
<section id="socios" class="active">
  <h1>Socios cargados</h1>
  <div class="grid" id="lista"></div>
</section>

<!-- ===== ALTA ===== -->
<section id="alta">
  <h1>Alta de socio</h1>
  <form onsubmit="altaSocio(event)">
    <input placeholder="Nombre" id="nombre" required>
    <input placeholder="Apellido" id="apellido" required>
    <input placeholder="DNI" id="dni" required>
    <input type="date" id="vence" required>
    <button>Guardar socio</button>
  </form>
</section>

<!-- ===== STATS ===== -->
<section id="stats">
  <h1>Estadísticas</h1>
  <div class="stats">
    <div class="stat"><strong id="tTotal">0</strong><span>Total socios</span></div>
    <div class="stat"><strong id="tActivos">0</strong><span>Activos</span></div>
    <div class="stat"><strong id="tInactivos">0</strong><span>Inactivos</span></div>
    <div class="stat"><strong id="tPorcentaje">0%</strong><span>% Activos</span></div>
  </div>
</section>

</main>

<!-- ===== MODAL ===== -->
<div class="modal" id="modal">
  <div class="box">
    <span class="close" onclick="modal.style.display='none'">✕</span>
    <h2 id="mNombre"></h2>
    <img id="mQR">
    <div id="mEstado"></div>
    <div id="mVence"></div>
  </div>
</div>

<script>
const SOCIOS_URL = "https://opensheet.elk.sh/132gab3uRyy7_DnkFoyCNbBnoxXDu6gbXiIDr5LTe4nA/SOCIOS";

const lista = document.getElementById("lista");
const modal = document.getElementById("modal");

function show(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll("aside button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

fetch(SOCIOS_URL).then(r=>r.json()).then(data=>{
  lista.innerHTML="";
  let activos=0;

  data.forEach(s=>{
    if(s.Estado==="ACTIVO") activos++;

    lista.innerHTML+=`
      <div class="card" onclick='ver(${JSON.stringify(s)})'>
        <strong>${s.Nombre} ${s.Apellido}</strong>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://socioskehilasfe-coder.github.io/validacion-socios/socio.html?id=${s.ID}">
        <div class="estado ${s.Estado==="ACTIVO"?"activo":"inactivo"}">${s.Estado}</div>
        <div class="vence">Vence: ${s.VENCE}</div>
      </div>`;
  });

  tTotal.textContent=data.length;
  tActivos.textContent=activos;
  tInactivos.textContent=data.length-activos;
  tPorcentaje.textContent=Math.round((activos*100)/data.length)+"%";
});

function ver(s){
  mNombre.textContent=s.Nombre+" "+s.Apellido;
  mQR.src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=https://socioskehilasfe-coder.github.io/validacion-socios/socio.html?id="+s.ID;
  mEstado.innerHTML="<strong>"+s.Estado+"</strong>";
  mVence.textContent="Vence: "+s.VENCE;
  modal.style.display="flex";
}

function altaSocio(e){
  e.preventDefault();
  alert("Alta conectada a Apps Script (ya funcionando)");
}
</script>

</body>
</html>
